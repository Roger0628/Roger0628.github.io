---
title: Clase 16 - Examen Final
date: 2024-09-27 21:00:00 -05:00
categories: [Page]
tags: [Made, GitHub]  # TAG names should always be lowercase
---

# Uso de Procmon y Sysmon para Investigar Actividad de Procesos Sospechosos

## 1. ¿Cómo podrías utilizar Procmon y Sysmon juntos para investigar la actividad de un proceso sospechoso? (5 ptos)

Para investigar la actividad de un proceso sospechoso utilizando tanto Procmon como Sysmon, se pueden seguir los siguientes pasos:

1. **Instalación y Configuración**:
   - Instalar Sysmon en el sistema y configurarlo adecuadamente para capturar eventos relevantes, como la creación de procesos y cambios en el registro.
   - Iniciar Procmon y establecer filtros específicos para el proceso en cuestión, por ejemplo, filtrando por el nombre del proceso sospechoso.

2. **Monitoreo en Tiempo Real**:
   - Utilizar Procmon para observar la actividad en tiempo real del proceso, incluyendo accesos a archivos y cambios en el registro.
   - Usar Sysmon para registrar eventos de red y otros eventos del sistema que puedan estar relacionados con la actividad del proceso.

3. **Análisis de Registros**:
   - Analizar los registros generados por Procmon para identificar interacciones inusuales con archivos o claves del registro.
   - Revisar los eventos de Sysmon para detectar conexiones de red sospechosas o actividad de procesos no autorizados.

4. **Correlación de Eventos**:
   - Correlacionar los eventos observados en Procmon con los eventos registrados por Sysmon para obtener un panorama más claro de la actividad del proceso sospechoso.

5. **Documentación y Reporte**:
   - Documentar los hallazgos y crear un informe detallado que incluya los eventos clave observados en ambas herramientas, facilitando la respuesta ante incidentes.

## 1.1. Explica los tipos de eventos que Procmon y Sysmon pueden capturar de forma complementaria.

### Procmon
- **Acceso a Archivos**: Captura todas las operaciones de lectura y escritura en archivos.
- **Acceso al Registro**: Registra cambios en el registro de Windows.
- **Creación y Terminación de Procesos**: Monitorea el inicio y fin de procesos.
- **Interacciones con el Sistema de Archivos**: Incluye operaciones como abrir, cerrar y modificar archivos.

### Sysmon
- **Creación de Procesos**: Registra la información sobre cómo y cuándo los procesos son creados.
- **Conexiones de Red**: Captura detalles de conexiones de red, incluyendo IP de origen y destino.
- **Cambios en el Registro**: Monitorea eventos específicos de modificación en el registro.
- **Eventos de Archivo**: Registra eventos relacionados con la creación, modificación y eliminación de archivos.

### Complementariedad
- Procmon es ideal para captar interacciones detalladas a nivel de sistema de archivos y registro, mientras que Sysmon proporciona un contexto de red y eventos del sistema, lo que permite una evaluación más exhaustiva de la actividad sospechosa.

## 1.2. Proporciona un ejemplo práctico de cómo identificar un posible comportamiento malicioso en un proceso utilizando ambas herramientas.

### Ejemplo Práctico

1. **Paso 1: Configuración**
   - Instalar Sysmon y configurarlo para capturar eventos de creación de procesos y conexiones de red.
   - Iniciar Procmon y establecer un filtro para el proceso sospechoso, por ejemplo, `malicious.exe`.

2. **Paso 2: Monitoreo**
   - Observar los registros de Procmon para identificar accesos inusuales a archivos, como intentos de abrir archivos en directorios del sistema o archivos temporales.
   - Revisar los eventos de Sysmon para detectar conexiones de red hacia IPs desconocidas o no autorizadas.

3. **Paso 3: Análisis**
   - Supongamos que `malicious.exe` intenta acceder a un archivo en `C:\Windows\System32\` y establece una conexión de red a una IP no reconocida.
   - Comparar los tiempos y eventos en Procmon con las conexiones reportadas por Sysmon para establecer patrones y correlaciones.

4. **Paso 4: Conclusión**
   - Si se determina que `malicious.exe` accedió a archivos críticos del sistema y se conectó a una IP que está en listas negras, se puede concluir que está exhibiendo comportamientos maliciosos.

## Referencias
- [Microsoft Sysinternals - Sysmon](https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon)
- [Microsoft Sysinternals - Process Monitor](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon)
- [Investigating Malware with Sysinternals Tools](https://www.blackhillsinfosec.com/investigating-malware-with-sysinternals-tools)

## Conclusión

La combinación de Procmon y Sysmon permite una investigación forense más robusta al proporcionar diferentes perspectivas sobre la actividad del sistema. Utilizar ambas herramientas de manera complementaria facilita la identificación de comportamientos maliciosos y mejora la respuesta ante incidentes de seguridad.

# Diferencias entre los eventos ProcessCreate y ProcessAccess en Sysmon

## 2. En Sysmon, ¿qué diferencias existen entre los eventos ProcessCreate y ProcessAccess, y qué utilidad tienen cada uno para un analista de seguridad? (5 ptos)

Los eventos **ProcessCreate** y **ProcessAccess** en Sysmon son fundamentales para el monitoreo de la actividad en un sistema, pero capturan diferentes aspectos del comportamiento de los procesos.

### Event ProcessCreate
- **Descripción**: Este evento se genera cuando un nuevo proceso es creado en el sistema. Proporciona información sobre el proceso que se inicia, incluyendo su nombre, identificador, y la ruta del ejecutable.
- **Utilidad**: Permite a los analistas de seguridad identificar cuándo se inician nuevos procesos, lo que puede ser crucial para detectar comportamientos sospechosos, como la ejecución de malware o de herramientas no autorizadas.

### Event ProcessAccess
- **Descripción**: Este evento se genera cuando un proceso accede a otro proceso. Captura información sobre el proceso que realiza el acceso, el proceso al que se accede, y el tipo de acceso que se solicita (lectura, escritura, etc.).
- **Utilidad**: Es útil para detectar actividades inusuales, como un proceso malicioso que intenta manipular otro proceso, lo que puede indicar intentos de escalada de privilegios o inyecciones de código.

## 2.1. Describe los atributos principales de ambos eventos.

### Atributos del Evento ProcessCreate
- **Event ID**: 4688
- **Image**: Ruta completa del ejecutable del proceso creado.
- **ProcessId**: Identificador del nuevo proceso.
- **CommandLine**: Línea de comandos utilizada para iniciar el proceso.
- **User**: Usuario que inició el proceso.
- **ParentProcessId**: Identificador del proceso padre que creó el nuevo proceso.

### Atributos del Evento ProcessAccess
- **Event ID**: 10
- **TargetProcessId**: Identificador del proceso que está siendo accedido.
- **SourceProcessId**: Identificador del proceso que realiza el acceso.
- **AccessMask**: Tipo de acceso solicitado (lectura, escritura, etc.).
- **User**: Usuario que está realizando la acción.
- **Image**: Ruta del ejecutable del proceso que está realizando el acceso.

## Escenarios Clave para la Detección de Amenazas

### Escenarios para ProcessCreate
1. **Ejecución de Malware**:
   - Si un proceso no autorizado, como `malicious.exe`, se inicia en el sistema, el evento ProcessCreate se registrará. Al monitorear la creación de procesos, un analista puede identificar rápidamente la ejecución de malware.

2. **Instalación de Software No Autorizado**:
   - La creación de procesos relacionados con la instalación de software no reconocido puede ser un indicativo de un ataque de ingeniería social o de un compromiso de seguridad. Este evento alertaría a los analistas sobre el inicio de dicho proceso.

### Escenarios para ProcessAccess
1. **Acceso No Autorizado a Procesos Sensibles**:
   - Un evento ProcessAccess podría indicar que un proceso sospechoso intenta acceder a procesos críticos del sistema, como los relacionados con la seguridad o la administración. Esto puede ser un indicio de un ataque en curso.

2. **Inyecciones de Código**:
   - Si un proceso malicioso intenta inyectar código en otro proceso legítimo (por ejemplo, un navegador o un servicio del sistema), el evento ProcessAccess registrará este intento, permitiendo a los analistas detectar y responder a la actividad maliciosa.

## Conclusión

La comprensión de los eventos ProcessCreate y ProcessAccess en Sysmon es crucial para los analistas de seguridad. Estos eventos no solo proporcionan visibilidad sobre la actividad de los procesos, sino que también ayudan a identificar comportamientos maliciosos y a responder ante posibles amenazas.

# Uso de FileCreateStreamHash en Sysmon y Detección de Alternate Data Streams (ADS)

## 3. En Procmon, ¿qué operación(es) corresponde(n) al evento FileCreateStreamHash en Sysmon, y cómo podrías configurarlo en Sysmon para detectar un posible uso malicioso de Alternate Data Streams (ADS)? (5 ptos)

El evento **FileCreateStreamHash** en Sysmon está relacionado con la creación de flujos de datos alternativos (ADS) en archivos de NTFS. Este evento captura el hash del flujo de datos alternativo cuando se crea, lo que puede ser útil para detectar actividades maliciosas que utilicen ADS para ocultar información.

### Configuración en Sysmon

Para detectar el uso malicioso de Alternate Data Streams, puedes configurar Sysmon agregando la siguiente línea en el archivo de configuración:

```xml
<Sysmon schemaversion="4.50">
    <EventFiltering>
        <FileCreateStreamHash onmatch="include"/>
    </EventFiltering>
</Sysmon>



